import R from"./dialog.esm.pqJyvCCx.js";import{h as q,A as I,_ as L}from"./AsYouType.zyYu5v3_.js";import{x as M,n as O,C as V,g as D,u as t,o as b,c as x,a as r,F as T,A as S,s as f,t as B,d as J,b as X,w as j,q as v,v as $,z as F,G as Y,y as N,B as U,p as E,e as G,H as Z}from"./entry.MgUDxhFU.js";import{a as P,p as H,q as K}from"./auth.SZYyi0EM.js";import{_ as W}from"./_plugin-vue_export-helper.x3n3nnut.js";import"./index.esm.e4YD8uC-.js";import"./ripple.esm.M9rvyZ53.js";import"./basecomponent.esm.ZwRjb1O0.js";import"./portal.esm.P3ujgpuN.js";const Q=y=>(E("data-v-256ffc60"),y=y(),G(),y),ee={key:0,id:"dashboard",class:"h-[100vh] w-full bg-zinc-200 dark:bg-zinc-900 flex flex-col"},te={class:"h-full w-full flex flex-row"},ae={class:"h-full w-1/5 invisible md:visible px-3 pt-10 pb-4"},se={class:"h-full w-full flex flex-col"},re=["onClick"],ne={class:"text-neutral-700 dark:text-white"},de={class:"h-[95%] my-auto me-4 rounded-lg w-full md:w-4/5 px-3 pb-4 bg-zinc-300 dark:bg-zinc-800 shadow-xl"},oe={key:0,class:"w-full flex flex-col p-4"},ie={class:"w-full flex flex-row justify-between mb-4"},le=Q(()=>r("h1",{class:"text-neutral-700 dark:text-white text-5xl mt-2 mb-3 font-thin"},"My friends",-1)),me={class:"w-full flex flex-col min-h-[25vh] bg-zinc-900 dark:bg-black"},ue={class:"input_group w-full flex flex-row mt-3"},ce={class:"w-full md:w-1/2 px-2"},pe={class:"w-full md:w-1/2 px-2"},_e={class:"input_group w-full flex flex-row mt-3"},he={class:"w-full md:w-2/3 px-2"},be={class:"w-full md:w-1/3 px-2"},fe={class:"input_group w-full flex flex-row mt-3"},we=["disabled"],ge={class:"w-full grid grid-cols-1 md:grid-cols-4"},xe=M({__name:"dashboard",setup(y){const p=Z(),d=P();H();const e=O({current_user:P.user,current_tab:null,dark_mode:!1,error:!1,use_the_force:!1,tabs:[{name:"My Friends",data:{adding_new:!1,posting_new:!1,post:null,new_member:{email:"",first_name:"",last_name:"",phone_number:"",n_id:`nsight-${d.user.id}-${q().format("MMDDYYYY-hmmss")}`}}},{name:"My Profile",data:{}}],validate:!1});V(()=>{e.current_tab=e.tabs[0]});const z=n=>n.length&&n.toString().toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),C=n=>/^\+\d{1,3}-\d{3}-\d{3}-\d{4}$/.test(n),A=async()=>{let n=e.tabs[0];n.data.posting_new=!0;const a={"Content-Type":"application/json",accept:"application/json",Authorization:`Bearer ${d.token}`};n.post=$fetch(`${p.public.NUXT_STRAPI_URL}/api/nsight-ids?${K.stringify({filters:{nsight_id:e.tabs[0].data.new_member.n_id}})}`,{method:"GET",headers:a}).then(_=>{if(_.data.length){const h="nsight id already exists. Please try again.";console.log(h,res.data),e.error=h}else{let h={data:{authentic:!0,nsight_id:n.data.new_member.n_id}};$fetch(`${p.public.NUXT_STRAPI_URL}/api/nsight-ids?populate=*`,{method:"POST",headers:a,body:JSON.stringify(h)}).then(u=>{console.log("New nsight id added",u);const w=u.data;let o={blocked:!1,confirmed:!1,email:n.data.new_member.email,first_name:n.data.new_member.first_name,last_name:n.data.new_member.last_name,phone_number:n.data.new_member.phone_number,nsight_id:w,square_id:"",preferences:[{dark_mode:!0}],username:n.data.new_member.email,password:"P@ssW3rd9756",users:[d.user],friends:[d.user],profile_picture:{},favorites:{products:[],users:[]},pictures:[],addresses:{shipping:[],billing:[]},selected_addresses:{shipping:null,billing:null},selected_payment_method:null,payment_methods:{data:[]},cart_obj:{data:[]},orders:{data:[]},returns:{data:[]},cancelled_orders:{data:[]},role:{id:1,name:"Authenticated",description:"Default role given to authenticated user.",type:"authenticated",connect:[{id:1}]}};$fetch(`${p.public.NUXT_STRAPI_URL}/api/users`,{method:"POST",headers:a,body:JSON.stringify(o)}).then(l=>{console.log("created new strapi member: ",l);const g=l;$fetch(`${p.public.NUXT_STRAPI_URL}/api/nsight-ids/${w.id}`,{method:"PUT",headers:a,body:JSON.stringify({data:{user:[g]}})}).then(async c=>{console.log("updated nsight_id with new user: ",c);const k={givenName:o.first_name,familyName:o.last_name,emailAddress:o.email,phoneNumber:o.phone_number},i=await $fetch("/api/square/create-customer",{method:"POST",headers:a,body:JSON.stringify(k)});o.square_id=i.customer.id,i.customer&&i.customer.id&&(o.square_id=i.customer.id,U(()=>{o.square_id=i.customer.id,console.log("updated new_nsight_member with square_id: ",o),$fetch(`${p.public.NUXT_STRAPI_URL}/api/users/${g.id}`,{method:"PUT",headers:a,body:JSON.stringify({square_id:i.customer.id})}).then(s=>{console.log("updated strapi user with square_id: ",s),d.user.friends.push(s),d.user.users.push(s),e.tabs[1].data.adding_new=!1,U(()=>{$fetch(`${p.public.NUXT_STRAPI_URL}/api/users/${d.user.id}`,{method:"PUT",headers:a,body:JSON.stringify({data:d.user})}).then(m=>{console.log("updated strapi user with new member: ",m),n.data.posting_new=!1,e.tabs[0].data.adding_new=!1}).catch(m=>{console.log("error updating strapi user with new member: ",m),e.error=m})})}).catch(s=>{console.log("error updating strapi user with square_id: ",s),e.error=s})}))}).catch(c=>{console.log("error updating nsight_id with new user: ",c),e.error=c})}).catch(l=>{console.log("error creating new member: ",l),e.error=l})}).catch(u=>{e.error=u})}}).catch(_=>(console.log("nsight error",_),_))};return D(()=>e.tabs[0].data.new_member,n=>{e.validate=n.email.length>0&&z(n.email)&&n.first_name.length>0&&n.last_name.length>0&&C(n.phone_number)},{deep:!0}),(n,a)=>{var u,w,o,l,g,c,k,i;const _=R,h=L;return(u=t(d))!=null&&u.user?(b(),x("div",ee,[r("div",te,[r("div",ae,[r("div",se,[(b(!0),x(T,null,S(t(e).tabs,(s,m)=>(b(),x("div",{key:m,class:f(["w-full py-4 px-8 hover:shadow-xl mb-2 hover:cursor-pointer hover:bg-zinc-300 dark:hover:bg-zinc-700 rounded-lg",s==t(e).current_tab?"bg-zinc-300 dark:bg-zinc-800 shadow-xl":""]),onClick:ye=>t(e).current_tab=s},[r("span",ne,B(s.name),1)],10,re))),128))])]),r("div",de,[((o=(w=t(e))==null?void 0:w.current_tab)==null?void 0:o.name)=="My Friends"?(b(),x("div",oe,[r("div",ie,[le,r("button",{class:"nsight-btn-primary w-1/5 h-[40px] text-neutral-700 dark:text-white px-2 rounded uppercase",onClick:a[6]||(a[6]=s=>t(e).tabs[0].data.adding_new=!t(e).tabs[0].data.adding_new)},[J(" invite "),X(_,{visible:t(e).tabs[0].data.adding_new,"onUpdate:visible":a[5]||(a[5]=s=>t(e).tabs[0].data.adding_new=s),modal:"",header:"invite a friend",style:F({width:"50rem",backgroundColor:(c=(g=(l=t(d))==null?void 0:l.user)==null?void 0:g.preferences[0])!=null&&c.dark_mode?"#18181a":"#a1a1aa",color:"white",padding:"1rem"})},{default:j(()=>[r("div",me,[r("div",ue,[r("div",ce,[v(r("input",{type:"text",class:f(["w-full p-2 mb-1 me-3 rounded-md border-gray-300 bg-transparent placeholder:text-neutral-700 dark:placeholder:text-white dark:text-white",t(d).user.preferences[0].dark_mode?"border-dark":"border-light"]),placeholder:"First Name","onUpdate:modelValue":a[0]||(a[0]=s=>t(e).tabs[0].data.new_member.first_name=s)},null,2),[[$,t(e).tabs[0].data.new_member.first_name]])]),r("div",pe,[v(r("input",{type:"text",class:f(["w-full p-2 mb-1 me-3 rounded-md border-gray-300 bg-transparent placeholder:text-neutral-700 dark:placeholder-white dark:text-white",t(d).user.preferences[0].dark_mode?"border-dark":"border-light"]),placeholder:"Last Name","onUpdate:modelValue":a[1]||(a[1]=s=>t(e).tabs[0].data.new_member.last_name=s)},null,2),[[$,t(e).tabs[0].data.new_member.last_name]])])]),r("div",_e,[r("div",he,[v(r("input",{type:"email",class:f(["w-full p-2 mb-1 me-3 rounded-md border-gray-300 bg-transparent placeholder:text-neutral-700 dark:placeholder:text-white dark:text-white",t(d).user.preferences[0].dark_mode?"border-dark":"border-light"]),placeholder:"Email","onUpdate:modelValue":a[2]||(a[2]=s=>t(e).tabs[0].data.new_member.email=s)},null,2),[[$,t(e).tabs[0].data.new_member.email]])]),r("div",be,[v(r("input",{type:"text",class:f(["w-full p-2 mb-1 me-3 rounded-md border-gray-300 bg-transparent placeholder:text-neutral-700 dark:placeholder-white dark:text-white",t(d).user.preferences[0].dark_mode?"border-dark":"border-light"]),"onUpdate:modelValue":a[3]||(a[3]=s=>t(e).tabs[0].data.new_member.phone_number=s),pattern:"[0-9\\-]*",placeholder:"+1-123-456-7890",onKeydown:a[4]||(a[4]=()=>{t(e).tabs[0].data.new_member.phone_number=new(t(I))().input(t(e).tabs[0].data.new_member.phone_number).replace(/\s/g,"-")})},null,34),[[$,t(e).tabs[0].data.new_member.phone_number]])])]),r("div",fe,[r("button",{class:"nsight-btn-primary px-4 py-2 text-neutral-700 dark:text-white w-full rounded-md mx-2 shadow-xl",disabled:!t(e).validate,onClick:A},[r("span",{class:f(t(e).validate?"opacity-1":"opacity-50")},"invite friend",2)],8,we)])])]),_:1},8,["visible","style"])])]),r("div",ge,[(b(!0),x(T,null,S((i=(k=t(d))==null?void 0:k.user)==null?void 0:i.friends,(s,m)=>(b(),Y(h,{key:m,member:s},null,8,["member"]))),128))])])):N("",!0)])])])):N("",!0)}}}),Ce=W(xe,[["__scopeId","data-v-256ffc60"]]);export{Ce as default};
