import{h as j,_ as E}from"./moment.P1EEmP5q.js";import{y as Y,n as F,h as Z,q as d,z as o,o as v,s as U,w as a,b as e,d as y,c as T,C as x,F as C,A as P,B as G,L as W,D as H,t as K,p as Q,e as ee,a as R,J as te,_ as ae}from"./entry.xkWbsTyt.js";import{u as ne,a as A,p as se}from"./auth.csaudZT0.js";const I=V=>(Q("data-v-ffca3281"),V=V(),ee(),V),oe={key:0},re=I(()=>R("strong",{style:{"font-size":"200%"}},"+",-1)),le=I(()=>R("span",{class:"headline"},"invite new member",-1)),de=Y({__name:"dashboard",setup(V){const h=te(),q=ne(),m=A(),L=se(),t=F({current_user:A.user,current_tab:null,dark_mode:!1,error:!1,use_the_force:!1,tabs:[{name:"My Profile",data:{}},{name:"My Members",data:{adding_new:!1,posting_new:!1,post:null,new_member:{email:"",first_name:"",last_name:"",phone_number:"",n_id:`nsight-${m.user.id}-${j().format("MMDDYYYY-hmmss")}`}}}],validate:!1}),M=()=>{let s="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$";for(let c=1;c<=8;c++){var _=Math.floor(Math.random()*n.length+1);s+=n.charAt(_)}return s},O=s=>s.length&&s.toString().toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),z=s=>s.length&&s.toString().match(/^[0-9\-]*$/),B=async()=>{let s=t.tabs[1];s.data.posting_new=!0;const n={"Content-Type":"application/json",accept:"application/json",Authorization:`Bearer ${m.token}`};s.post=$fetch(`${h.public.NUXT_STRAPI_URL}/api/nsight-ids?${W.stringify({filters:{nsight_id:t.tabs[1].data.new_member.n_id}})}`,{method:"GET",headers:n}).then(_=>{if(_.data.length){const c="nsight id already exists. Please try again.";console.log(c,_.data),t.error=c}else{let c={data:{authentic:!0,nsight_id:s.data.new_member.n_id}};$fetch(`${h.public.NUXT_STRAPI_URL}/api/nsight-ids?populate=*`,{method:"POST",headers:n,body:JSON.stringify(c)}).then(g=>{console.log("New nsight id added",g);const $=g.data;let l={blocked:!1,confirmed:!1,email:s.data.new_member.email,first_name:s.data.new_member.first_name,last_name:s.data.new_member.last_name,phone_number:s.data.new_member.phone_number,nsight_id:$,preferences:[{dark_mode:!0}],username:s.data.new_member.email,medusa_password:M(),password:"P@ssW3rd9756",users:[m.user],friends:[m.user],addresses:{shipping:[],billing:[]},selected_addresses:{shipping:null,billing:null},selected_payment_method:null,payment_methods:{data:[]},role:{id:1,name:"Authenticated",description:"Default role given to authenticated user.",type:"authenticated",connect:[{id:1}]}};$fetch(`${h.public.NUXT_STRAPI_URL}/api/users`,{method:"POST",headers:n,body:JSON.stringify(l)}).then(p=>{console.log("created new strapi member: ",p);const f=p;$fetch(`${h.public.NUXT_STRAPI_URL}/api/nsight-ids/${$.id}`,{method:"PUT",headers:n,body:JSON.stringify({data:{user:[f]}})}).then(u=>{console.log("updated nsight_id with new user: ",u),q.customers.create({first_name:l.first_name,last_name:l.last_name,password:l.medusa_password,email:l.email}).then(async b=>{console.log("created new medusa member: ",b);try{const{square_data_result:i}=await L.square_client.customersApi.createCustomer({givenName:l.first_name,familyName:l.last_name,emailAddress:l.email,phoneNumber:l.phone_number})}catch(i){console.log("error creating new square customer: ",i),t.error=i.result}$fetch(`${h.public.NUXT_STRAPI_URL}/api/users/${f.id}`,{method:"PUT",headers:n,body:JSON.stringify({data:{medusa_id:b.id}})}).then(i=>{console.log("updated strapi user with medusa_id: ",i),m.user.friends.push(i),m.user.users.push(i),t.tabs[1].data.adding_new=!1,H(()=>{$fetch(`${h.public.NUXT_STRAPI_URL}/api/users/${m.user.id}`,{method:"PUT",headers:n,body:JSON.stringify({data:m.user})}).then(w=>{console.log("updated strapi user with new member: ",w),s.data.posting_new=!1}).catch(w=>{console.log("error updating strapi user with new member: ",w),t.error=w})})}).catch(i=>{console.log("error updating strapi user with medusa_id: ",i),t.error=i})}).catch(b=>{console.log("error creating new medusa member: ",b),t.error=b})}).catch(u=>{console.log("error updating nsight_id with new user: ",u),t.error=u})}).catch(p=>{console.log("error creating new member: ",p),t.error=p})}).catch(g=>{t.error=g})}}).catch(_=>(console.log("nsight error",_),_))};return Z(()=>t.tabs[1].data.new_member,s=>{t.validate=s.email.length>0&&O(s.email)&&s.first_name.length>0&&s.last_name.length>0&&z(s.phone_number)},{deep:!0}),(s,n)=>{const _=d("v-card-title"),c=d("v-tab"),g=d("v-tabs"),$=E,l=d("v-col"),p=d("v-tooltip"),f=d("v-text-field"),u=d("v-row"),b=d("v-form"),i=d("v-card-text"),w=d("v-spacer"),k=d("v-btn"),D=d("v-card-actions"),N=d("v-card"),J=d("v-dialog"),X=d("v-window");return o(m).user?(v(),U(u,{key:0,id:"dashboard",class:G(o(m).user.preferences[0].dark_mode?"bg-dark":"bg-light")},{default:a(()=>[e(l,{class:"h-100"},{default:a(()=>[e(N,{theme:o(m).user.preferences[0].dark_mode?"dark":"light",class:"mx-3 my-3 h-100 overflow-auto"},{default:a(()=>[e(_,null,{default:a(()=>[y("let's get it")]),_:1}),e(i,null,{default:a(()=>[e(g,{modelValue:o(t).current_tab,"onUpdate:modelValue":n[0]||(n[0]=r=>o(t).current_tab=r)},{default:a(()=>[(v(!0),T(C,null,x(o(t).tabs,(r,S)=>(v(),U(c,{key:S},{default:a(()=>[y(K(r.name),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(X,{modelValue:o(t).current_tab,"onUpdate:modelValue":n[8]||(n[8]=r=>o(t).current_tab=r)},{default:a(()=>[o(t).current_tab==1?(v(),T("div",oe,[e(u,{class:"my-3"},{default:a(()=>[(v(!0),T(C,null,x(o(m).user.friends,(r,S)=>(v(),U(l,{key:S,cols:"12",sm:"6",md:"3",lg:"2",xl:"1"},{default:a(()=>[e($,{member:r},null,8,["member"])]),_:2},1024))),128)),e(l,{cols:"12",sm:"6",md:"3",lg:"2",xl:"1"},{default:a(()=>[e(N,{variant:"tonal",class:"w-100 h-100"},{default:a(()=>[e(i,{class:"d-flex w-100 h-100 justify-center align-center"},{default:a(()=>[e(k,{onClick:n[7]||(n[7]=r=>o(t).tabs[1].data.adding_new=!0),flat:""},{default:a(()=>[re,e(p,{activator:"parent",location:"top","open-delay":"500"},{default:a(()=>[y("Invite new member")]),_:1}),e(J,{modelValue:o(t).tabs[1].data.adding_new,"onUpdate:modelValue":n[6]||(n[6]=r=>o(t).tabs[1].data.adding_new=r),width:"600"},{default:a(()=>[e(u,null,{default:a(()=>[e(l,null,{default:a(()=>[e(N,{flat:"",variant:"flat"},{default:a(()=>[e(_,null,{default:a(()=>[le]),_:1}),e(i,null,{default:a(()=>[e(b,null,{default:a(()=>[e(u,{dense:""},{default:a(()=>[e(l,{dense:""},{default:a(()=>[e(f,{modelValue:o(t).tabs[1].data.new_member.first_name,"onUpdate:modelValue":n[1]||(n[1]=r=>o(t).tabs[1].data.new_member.first_name=r),label:"First Name",required:""},null,8,["modelValue"])]),_:1}),e(l,{dense:""},{default:a(()=>[e(f,{modelValue:o(t).tabs[1].data.new_member.last_name,"onUpdate:modelValue":n[2]||(n[2]=r=>o(t).tabs[1].data.new_member.last_name=r),label:"Last Name",required:""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{dense:""},{default:a(()=>[e(l,{cols:"7",dense:""},{default:a(()=>[e(f,{modelValue:o(t).tabs[1].data.new_member.email,"onUpdate:modelValue":n[3]||(n[3]=r=>o(t).tabs[1].data.new_member.email=r),label:"Email",required:""},null,8,["modelValue"])]),_:1}),e(l,{cols:"5",dense:""},{default:a(()=>[e(f,{modelValue:o(t).tabs[1].data.new_member.phone_number,"onUpdate:modelValue":n[4]||(n[4]=r=>o(t).tabs[1].data.new_member.phone_number=r),label:"Phone Number",required:"",pattern:"[0-9\\-]*"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(w),e(k,{color:"blue darken-1",text:"",onClick:n[5]||(n[5]=r=>o(t).tabs[1].data.adding_new=!1)},{default:a(()=>[y("Cancel")]),_:1}),e(k,{disabled:!o(t).validate,color:"blue darken-1",text:"",onClick:B},{default:a(()=>[y("Invite")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])):P("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["theme"])]),_:1})]),_:1},8,["class"])):P("",!0)}}}),ue=ae(de,[["__scopeId","data-v-ffca3281"]]);export{ue as default};
