import{h as B,_ as D}from"./moment.XRzeILc3.js";import{H as j,n as E,h as x,q as l,I as s,o as y,s as V,w as a,b as t,d as $,c as N,x as P,F as C,v as R,u as Y,J as F,A as Z,t as G,p as H,e as W,a as A,y as K,_ as Q}from"./entry.edFZpnpL.js";import{u as ee,a as I}from"./auth.mQ8edLOI.js";const L=T=>(H("data-v-f1b6d948"),T=T(),W(),T),te={key:0},ae=L(()=>A("strong",{style:{"font-size":"200%"}},"+",-1)),ne=L(()=>A("span",{class:"headline"},"invite new member",-1)),se=j({__name:"dashboard",setup(T){const f=K(),O=ee(),d=I(),e=E({current_user:I.user,current_tab:null,dark_mode:!1,error:!1,use_the_force:!1,tabs:[{name:"My Profile",data:{}},{name:"My Members",data:{adding_new:!1,posting_new:!1,post:null,new_member:{email:"",first_name:"",last_name:"",n_id:`nsight-${d.user.id}-${B().format("MMDDYYYY-hmmss")}`}}}],validate:!1}),J=o=>o.toString().toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),M=async()=>{let o=e.tabs[1];o.data.posting_new=!0;const n={"Content-Type":"application/json",accept:"application/json",Authorization:`Bearer ${d.token}`};o.post=$fetch(`${f.public.NUXT_STRAPI_URL}/api/nsight-ids?${F.stringify({filters:{nsight_id:e.tabs[1].data.new_member.n_id}})}`,{method:"GET",headers:n}).then(u=>{if(u.data.length){const h="nsight id already exists. Please try again.";console.log(h,u.data),e.error=h}else{let h={data:{authentic:!0,nsight_id:o.data.new_member.n_id}};$fetch(`${f.public.NUXT_STRAPI_URL}/api/nsight-ids?populate=*`,{method:"POST",headers:n,body:JSON.stringify(h)}).then(g=>{console.log("New nsight id added",g);const U=g.data;let i={blocked:!1,confirmed:!1,email:o.data.new_member.email,first_name:o.data.new_member.first_name,last_name:o.data.new_member.last_name,nsight_id:U,preferences:[{dark_mode:!0}],username:o.data.new_member.email,password:"P@ssW3rd9756",users:[d.user],friends:[d.user],role:{id:1,name:"Authenticated",description:"Default role given to authenticated user.",type:"authenticated",connect:[{id:1}]}};$fetch(`${f.public.NUXT_STRAPI_URL}/api/users`,{method:"POST",headers:n,body:JSON.stringify(i)}).then(p=>{console.log("created new strapi member: ",p);const w=p;$fetch(`${f.public.NUXT_STRAPI_URL}/api/nsight-ids/${U.id}`,{method:"PUT",headers:n,body:JSON.stringify({data:{user:[w]}})}).then(_=>{console.log("updated nsight_id with new user: ",_),O.customers.create({first_name:i.first_name,last_name:i.last_name,password:i.password,email:i.email}).then(b=>{console.log("created new medusa member: ",b),$fetch(`${f.public.NUXT_STRAPI_URL}/api/users/${w.id}`,{method:"PUT",headers:n,body:JSON.stringify({data:{medusa_id:b.id}})}).then(m=>{console.log("updated strapi user with medusa_id: ",m),d.user.friends.push(m),d.user.users.push(m),e.tabs[1].data.adding_new=!1,Z(()=>{$fetch(`${f.public.NUXT_STRAPI_URL}/api/users/${d.user.id}`,{method:"PUT",headers:n,body:JSON.stringify({data:d.user})}).then(v=>{console.log("updated strapi user with new member: ",v),$fetch(`${f.public.NUXT_STRAPI_URL}/api/auth/send-email-confirmation`,{method:"POST",headers:n,body:JSON.stringify({email:o.data.new_member.email})}).then(c=>{console.log("email confirmation sent to new member: ",c),o.data.posting_new=!1}).catch(c=>{console.log("error sending email confirmation to new member: ",c),e.error=c})}).catch(v=>{console.log("error updating strapi user with new member: ",v),e.error=v})})}).catch(m=>{console.log("error updating strapi user with medusa_id: ",m),e.error=m})}).catch(b=>{console.log("error creating new medusa member: ",b),e.error=b})}).catch(_=>{console.log("error updating nsight_id with new user: ",_),e.error=_})}).catch(p=>{console.log("error creating new member: ",p),e.error=p})}).catch(g=>{e.error=g})}}).catch(u=>(console.log("nsight error",u),u))};return x(()=>e.tabs[1].data.new_member.email,o=>{e.validate=o.length>0&&J(o)}),x(()=>e.tabs[1].data.new_member.first_name,o=>{e.validate=o.length>0}),(o,n)=>{const u=l("v-card-title"),h=l("v-tab"),g=l("v-tabs"),U=D,i=l("v-col"),p=l("v-tooltip"),w=l("v-text-field"),_=l("v-row"),b=l("v-form"),m=l("v-card-text"),v=l("v-spacer"),c=l("v-btn"),X=l("v-card-actions"),k=l("v-card"),q=l("v-dialog"),z=l("v-window");return s(d).user?(y(),V(_,{key:0,id:"dashboard",class:Y(s(d).user.preferences[0].dark_mode?"bg-dark":"bg-light")},{default:a(()=>[t(i,{class:"h-100"},{default:a(()=>[t(k,{theme:s(d).user.preferences[0].dark_mode?"dark":"light",class:"mx-3 my-3 h-100 overflow-auto"},{default:a(()=>[t(u,null,{default:a(()=>[$("let's get it")]),_:1}),t(m,null,{default:a(()=>[t(g,{modelValue:s(e).current_tab,"onUpdate:modelValue":n[0]||(n[0]=r=>s(e).current_tab=r)},{default:a(()=>[(y(!0),N(C,null,P(s(e).tabs,(r,S)=>(y(),V(h,{key:S},{default:a(()=>[$(G(r.name),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),t(z,{modelValue:s(e).current_tab,"onUpdate:modelValue":n[7]||(n[7]=r=>s(e).current_tab=r)},{default:a(()=>[s(e).current_tab==1?(y(),N("div",te,[t(_,{class:"my-3"},{default:a(()=>[(y(!0),N(C,null,P(s(d).user.friends,(r,S)=>(y(),V(i,{key:S,cols:"12",sm:"6",md:"3",lg:"2",xl:"1"},{default:a(()=>[t(U,{member:r},null,8,["member"])]),_:2},1024))),128)),t(i,{cols:"12",sm:"6",md:"3",lg:"2",xl:"1"},{default:a(()=>[t(k,{variant:"tonal",class:"w-100 h-100"},{default:a(()=>[t(m,{class:"d-flex w-100 h-100 justify-center align-center"},{default:a(()=>[t(c,{onClick:n[6]||(n[6]=r=>s(e).tabs[1].data.adding_new=!0),flat:""},{default:a(()=>[ae,t(p,{activator:"parent",location:"top","open-delay":"500"},{default:a(()=>[$("Invite new member")]),_:1}),t(q,{modelValue:s(e).tabs[1].data.adding_new,"onUpdate:modelValue":n[5]||(n[5]=r=>s(e).tabs[1].data.adding_new=r),width:"600"},{default:a(()=>[t(_,null,{default:a(()=>[t(i,null,{default:a(()=>[t(k,{flat:"",variant:"flat"},{default:a(()=>[t(u,null,{default:a(()=>[ne]),_:1}),t(m,null,{default:a(()=>[t(b,null,{default:a(()=>[t(_,null,{default:a(()=>[t(i,null,{default:a(()=>[t(w,{modelValue:s(e).tabs[1].data.new_member.first_name,"onUpdate:modelValue":n[1]||(n[1]=r=>s(e).tabs[1].data.new_member.first_name=r),label:"First Name",required:""},null,8,["modelValue"])]),_:1}),t(i,null,{default:a(()=>[t(w,{modelValue:s(e).tabs[1].data.new_member.last_name,"onUpdate:modelValue":n[2]||(n[2]=r=>s(e).tabs[1].data.new_member.last_name=r),label:"Last Name",required:""},null,8,["modelValue"])]),_:1})]),_:1}),t(w,{modelValue:s(e).tabs[1].data.new_member.email,"onUpdate:modelValue":n[3]||(n[3]=r=>s(e).tabs[1].data.new_member.email=r),label:"Email",required:""},null,8,["modelValue"])]),_:1})]),_:1}),t(X,null,{default:a(()=>[t(v),t(c,{color:"blue darken-1",text:"",onClick:n[4]||(n[4]=r=>s(e).tabs[1].data.adding_new=!1)},{default:a(()=>[$("Cancel")]),_:1}),t(c,{disabled:!s(e).validate,color:"blue darken-1",text:"",onClick:M},{default:a(()=>[$("Invite")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])):R("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["theme"])]),_:1})]),_:1},8,["class"])):R("",!0)}}}),de=Q(se,[["__scopeId","data-v-f1b6d948"]]);export{de as default};
