import{h as z,A as Y,_ as j}from"./AsYouType.zyYu5v3_.js";import{x as E,n as F,g as G,D as l,u as s,o as v,G as S,w as n,b as e,d as y,c as U,A as x,t as Z,F as P,y as q,s as H,B as A,p as K,e as W,a as R,H as Q}from"./entry.MgUDxhFU.js";import{a as C,p as ee,q as te}from"./auth.SZYyi0EM.js";import{_ as ae}from"./_plugin-vue_export-helper.x3n3nnut.js";const I=V=>(K("data-v-fb11572a"),V=V(),W(),V),ne={key:0},se=I(()=>R("strong",{style:{"font-size":"200%"}},"+",-1)),oe=I(()=>R("span",{class:"headline"},"invite new member",-1)),re=E({__name:"dashboard_legacy",setup(V){const g=Q();useMedusaClient();const i=C();ee();const t=F({current_user:C.user,current_tab:null,dark_mode:!1,error:!1,use_the_force:!1,tabs:[{name:"My Profile",data:{}},{name:"My Members",data:{adding_new:!1,posting_new:!1,post:null,new_member:{email:"",first_name:"",last_name:"",phone_number:"",n_id:`nsight-${i.user.id}-${z().format("MMDDYYYY-hmmss")}`}}}],validate:!1}),L=()=>{let o="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$";for(let c=1;c<=8;c++){var _=Math.floor(Math.random()*a.length+1);o+=a.charAt(_)}return o},M=o=>o.length&&o.toString().toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),O=o=>/^\+\d{1,3}-\d{3}-\d{3}-\d{4}$/.test(o),B=async()=>{let o=t.tabs[1];o.data.posting_new=!0;const a={"Content-Type":"application/json",accept:"application/json",Authorization:`Bearer ${i.token}`};o.post=$fetch(`${g.public.NUXT_STRAPI_URL}/api/nsight-ids?${te.stringify({filters:{nsight_id:t.tabs[1].data.new_member.n_id}})}`,{method:"GET",headers:a}).then(_=>{if(_.data.length){const c="nsight id already exists. Please try again.";console.log(c,res.data),t.error=c}else{let c={data:{authentic:!0,nsight_id:o.data.new_member.n_id}};$fetch(`${g.public.NUXT_STRAPI_URL}/api/nsight-ids?populate=*`,{method:"POST",headers:a,body:JSON.stringify(c)}).then(w=>{console.log("New nsight id added",w);const $=w.data;let d={blocked:!1,confirmed:!1,email:o.data.new_member.email,first_name:o.data.new_member.first_name,last_name:o.data.new_member.last_name,phone_number:o.data.new_member.phone_number,nsight_id:$,square_id:"",preferences:[{dark_mode:!0}],username:o.data.new_member.email,medusa_password:L(),password:"P@ssW3rd9756",users:[i.user],friends:[i.user],addresses:{shipping:[],billing:[]},selected_addresses:{shipping:null,billing:null},selected_payment_method:null,payment_methods:{data:[]},orders:{data:[]},returns:{data:[]},cancelled_orders:{data:[]},role:{id:1,name:"Authenticated",description:"Default role given to authenticated user.",type:"authenticated",connect:[{id:1}]}};$fetch(`${g.public.NUXT_STRAPI_URL}/api/users`,{method:"POST",headers:a,body:JSON.stringify(d)}).then(f=>{console.log("created new strapi member: ",f);const h=f;$fetch(`${g.public.NUXT_STRAPI_URL}/api/nsight-ids/${$.id}`,{method:"PUT",headers:a,body:JSON.stringify({data:{user:[h]}})}).then(async m=>{console.log("updated nsight_id with new user: ",m);const N={givenName:d.first_name,familyName:d.last_name,emailAddress:d.email,phoneNumber:d.phone_number},u=await $fetch("/api/square/create-customer",{method:"POST",headers:a,body:JSON.stringify(N)});d.square_id=u.customer.id,u.customer&&u.customer.id&&(d.square_id=u.customer.id,A(()=>{d.square_id=u.customer.id,console.log("updated new_nsight_member with square_id: ",d),$fetch(`${g.public.NUXT_STRAPI_URL}/api/users/${h.id}`,{method:"PUT",headers:a,body:JSON.stringify({square_id:u.customer.id})}).then(p=>{console.log("updated strapi user with square_id: ",p),i.user.friends.push(p),i.user.users.push(p),t.tabs[1].data.adding_new=!1,A(()=>{$fetch(`${g.public.NUXT_STRAPI_URL}/api/users/${i.user.id}`,{method:"PUT",headers:a,body:JSON.stringify({data:i.user})}).then(b=>{console.log("updated strapi user with new member: ",b),o.data.posting_new=!1}).catch(b=>{console.log("error updating strapi user with new member: ",b),t.error=b})})}).catch(p=>{console.log("error updating strapi user with square_id: ",p),t.error=p})}))}).catch(m=>{console.log("error updating nsight_id with new user: ",m),t.error=m})}).catch(f=>{console.log("error creating new member: ",f),t.error=f})}).catch(w=>{t.error=w})}}).catch(_=>(console.log("nsight error",_),_))};return G(()=>t.tabs[1].data.new_member,o=>{t.validate=o.email.length>0&&M(o.email)&&o.first_name.length>0&&o.last_name.length>0&&O(o.phone_number)},{deep:!0}),(o,a)=>{const _=l("v-card-title"),c=l("v-tab"),w=l("v-tabs"),$=j,d=l("v-col"),f=l("v-tooltip"),h=l("v-text-field"),m=l("v-row"),N=l("v-form"),u=l("v-card-text"),p=l("v-spacer"),b=l("v-btn"),D=l("v-card-actions"),T=l("v-card"),J=l("v-dialog"),X=l("v-window");return s(i).user?(v(),S(m,{key:0,id:"dashboard",class:H(s(i).user.preferences[0].dark_mode?"bg-dark":"bg-light")},{default:n(()=>[e(d,{class:"h-100"},{default:n(()=>[e(T,{theme:s(i).user.preferences[0].dark_mode?"dark":"light",class:"mx-3 my-3 h-100 overflow-auto"},{default:n(()=>[e(_,null,{default:n(()=>[y("let's get it")]),_:1}),e(u,null,{default:n(()=>[e(w,{modelValue:s(t).current_tab,"onUpdate:modelValue":a[0]||(a[0]=r=>s(t).current_tab=r)},{default:n(()=>[(v(!0),U(P,null,x(s(t).tabs,(r,k)=>(v(),S(c,{key:k},{default:n(()=>[y(Z(r.name),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(X,{modelValue:s(t).current_tab,"onUpdate:modelValue":a[9]||(a[9]=r=>s(t).current_tab=r)},{default:n(()=>[s(t).current_tab==1?(v(),U("div",ne,[e(m,{class:"my-3"},{default:n(()=>[(v(!0),U(P,null,x(s(i).user.friends,(r,k)=>(v(),S(d,{key:k,cols:"12",sm:"6",md:"3",lg:"2",xl:"1"},{default:n(()=>[e($,{member:r},null,8,["member"])]),_:2},1024))),128)),e(d,{cols:"12",sm:"6",md:"3",lg:"2",xl:"1"},{default:n(()=>[e(T,{variant:"tonal",class:"w-100 h-100"},{default:n(()=>[e(u,{class:"d-flex w-100 h-100 justify-center align-center"},{default:n(()=>[e(b,{onClick:a[8]||(a[8]=r=>s(t).tabs[1].data.adding_new=!0),flat:""},{default:n(()=>[se,e(f,{activator:"parent",location:"top","open-delay":"500"},{default:n(()=>[y("Invite new member")]),_:1}),e(J,{modelValue:s(t).tabs[1].data.adding_new,"onUpdate:modelValue":a[7]||(a[7]=r=>s(t).tabs[1].data.adding_new=r),width:"600"},{default:n(()=>[e(m,null,{default:n(()=>[e(d,null,{default:n(()=>[e(T,{flat:"",variant:"flat"},{default:n(()=>[e(_,null,{default:n(()=>[oe]),_:1}),e(u,null,{default:n(()=>[e(N,null,{default:n(()=>[e(m,{dense:""},{default:n(()=>[e(d,{dense:""},{default:n(()=>[e(h,{modelValue:s(t).tabs[1].data.new_member.first_name,"onUpdate:modelValue":a[1]||(a[1]=r=>s(t).tabs[1].data.new_member.first_name=r),label:"First Name",required:""},null,8,["modelValue"])]),_:1}),e(d,{dense:""},{default:n(()=>[e(h,{modelValue:s(t).tabs[1].data.new_member.last_name,"onUpdate:modelValue":a[2]||(a[2]=r=>s(t).tabs[1].data.new_member.last_name=r),label:"Last Name",required:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{dense:""},{default:n(()=>[e(d,{cols:"7",dense:""},{default:n(()=>[e(h,{modelValue:s(t).tabs[1].data.new_member.email,"onUpdate:modelValue":a[3]||(a[3]=r=>s(t).tabs[1].data.new_member.email=r),label:"Email",required:""},null,8,["modelValue"])]),_:1}),e(d,{cols:"5",dense:""},{default:n(()=>[e(h,{modelValue:s(t).tabs[1].data.new_member.phone_number,"onUpdate:modelValue":a[4]||(a[4]=r=>s(t).tabs[1].data.new_member.phone_number=r),label:"Phone Number",required:"",pattern:"[0-9\\-]*",placeholder:"+1-123-456-7890",onKeydown:a[5]||(a[5]=()=>{s(t).tabs[1].data.new_member.phone_number=new(s(Y))().input(s(t).tabs[1].data.new_member.phone_number).replace(/\s/g,"-")})},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,null,{default:n(()=>[e(p),e(b,{color:"blue darken-1",text:"",onClick:a[6]||(a[6]=r=>s(t).tabs[1].data.adding_new=!1)},{default:n(()=>[y("Cancel")]),_:1}),e(b,{disabled:!s(t).validate,color:"blue darken-1",text:"",onClick:B},{default:n(()=>[y("Invite")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])):q("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["theme"])]),_:1})]),_:1},8,["class"])):q("",!0)}}}),ue=ae(re,[["__scopeId","data-v-fb11572a"]]);export{ue as default};
